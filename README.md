# A1.art API åŒ…è£æœå‹™

åŸºæ–¼ FastAPI çš„ A1.art AI åœ–ç‰‡ç”Ÿæˆæœå‹™åŒ…è£å™¨ï¼Œæä¾›åœ–ç‰‡ä¸Šå‚³å’Œ AI åœ–ç‰‡ç”ŸæˆåŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹è‰²

- ğŸ–¼ï¸ **åœ–ç‰‡ä¸Šå‚³**: æ”¯æ´å¤šç¨®æ ¼å¼åœ–ç‰‡ä¸Šå‚³è‡³ A1.art å¹³å°
- ğŸ¨ **AI åœ–ç‰‡ç”Ÿæˆ**: åŸºæ–¼ä¸Šå‚³åœ–ç‰‡é€²è¡Œ AI é¢¨æ ¼è½‰æ›å’Œç”Ÿæˆ
- ğŸ“Š **ä»»å‹™ç‹€æ…‹è¿½è¹¤**: å³æ™‚æŸ¥è©¢åœ–ç‰‡ç”Ÿæˆä»»å‹™çš„åŸ·è¡Œç‹€æ…‹
- ğŸ“ **å®Œæ•´æ—¥èªŒ**: ä½¿ç”¨ RotatingFileHandler è¨˜éŒ„è©³ç´°æ“ä½œæ—¥èªŒ
- ğŸš€ **ç•°æ­¥è™•ç†**: ä½¿ç”¨ aiohttp æä¾›é«˜æ•ˆçš„ç•°æ­¥ API è«‹æ±‚

## ç³»çµ±è¦æ±‚

- Python 3.7+
- A1.art API Key

## å®‰è£èˆ‡è¨­ç½®

### 1. å®‰è£ä¾è³´

```bash
pip install -r requirements.txt
```

### 2. ç’°å¢ƒé…ç½®

åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å‰µå»º `.env` æª”æ¡ˆï¼š

```env
API_KEY=your_a1_art_api_key_here
```

### 3. æ¨¡æ¿é…ç½®

è¤‡è£½ `templates_sample.json` ç‚º `templates.json` ä¸¦æ ¹æ“šéœ€æ±‚ä¿®æ”¹æ¨¡æ¿åƒæ•¸ï¼š

```bash
cp templates_sample.json templates.json
```

ç·¨è¼¯ `templates.json` è¨­å®šä½ çš„æ¨¡æ¿ï¼š

```json
{
  "templates": [
    {
      "template_id": 0,
      "name": "ä½ çš„æ¨¡æ¿åç¨±",
      "app_id": "ä½ çš„ app_id",
      "version_id": "ä½ çš„ version_id",
      "cnet_form_id": "ä½ çš„ cnet_form_id",
      "template_image": "/static/template_images/your_template_image.jpg"
    }
  ]
}
```

**æ¨¡æ¿åƒæ•¸èªªæ˜**ï¼š
- `template_id`: æ¨¡æ¿ IDï¼ˆå¿…éœ€ï¼‰
- `name`: æ¨¡æ¿åç¨±ï¼ˆå¿…éœ€ï¼‰
- `app_id`: A1.art æ‡‰ç”¨ IDï¼ˆå¿…éœ€ï¼‰
- `version_id`: ç‰ˆæœ¬ IDï¼ˆå¿…éœ€ï¼‰
- `cnet_form_id`: ControlNet è¡¨å–® IDï¼ˆå¿…éœ€ï¼‰
- `template_image`: æ¨¡æ¿é è¦½åœ–ç‰‡è·¯å¾‘ï¼ˆé¸å¡«ï¼‰
  - åœ–ç‰‡æ‡‰æ”¾åœ¨ `static/template_images/` ç›®éŒ„ä¸‹
  - è·¯å¾‘æ ¼å¼ï¼š`/static/template_images/your_image.jpg`
  - **å»ºè­°ä½¿ç”¨ 3:4 æ¯”ä¾‹çš„åœ–ç‰‡**ï¼ˆä¾‹å¦‚ï¼š600x800ã€900x1200ï¼‰ä»¥ç²å¾—æœ€ä½³é¡¯ç¤ºæ•ˆæœ
  - å‰ç«¯æœƒä»¥ `aspect-ratio: 3/4` å®Œæ•´é¡¯ç¤ºåœ–ç‰‡ï¼Œä¸æœƒè£åˆ‡
  - å¦‚æœä¸æä¾›åœ–ç‰‡ï¼Œæ¨¡æ¿å¡ç‰‡å°‡åªé¡¯ç¤ºæ–‡å­—

**é‡è¦**ï¼š
- `templates.json` åŒ…å«ä½ çš„å¯¦éš›æ¨¡æ¿é…ç½®ï¼Œ**ä¸æœƒ**ä¸Šå‚³åˆ° Gitï¼ˆå·²åŠ å…¥ .gitignoreï¼‰
- `templates_sample.json` æ˜¯ç¯„ä¾‹æª”æ¡ˆï¼Œå¯ä»¥å®‰å…¨åœ°æäº¤åˆ° Git
- `static/template_images/` ç›®éŒ„ä¸­çš„åœ–ç‰‡**ä¸æœƒ**ä¸Šå‚³åˆ° Gitï¼ˆå·²åŠ å…¥ .gitignoreï¼‰
- ä¿®æ”¹æ¨¡æ¿å¾Œéœ€è¦é‡æ–°å•Ÿå‹•æœå‹™æ‰æœƒç”Ÿæ•ˆ

### 4. å•Ÿå‹•æœå‹™

```bash
python app.py
```

æœå‹™å°‡åœ¨ `http://localhost:1989` å•Ÿå‹•ã€‚

## API ä½¿ç”¨èªªæ˜

### 1. å‰µå»ºåœ–ç‰‡ç”Ÿæˆä»»å‹™

**ç«¯é»**: `POST /create`

**åƒæ•¸**:
- `file`: ä¸Šå‚³çš„åœ–ç‰‡æª”æ¡ˆ (å¿…éœ€)
- `app_id`: A1.art æ‡‰ç”¨ ID (é è¨­: "1912088126456299522")
- `version_id`: ç‰ˆæœ¬ ID (é è¨­: "1912088126460493825")  
- `cnet_form_id`: ControlNet è¡¨å–® ID (é è¨­: "17447123252810005")
- `generate_num`: ç”Ÿæˆåœ–ç‰‡æ•¸é‡ (é è¨­: 1)

**è«‹æ±‚ç¯„ä¾‹**:

```bash
curl -X POST "http://localhost:1989/create" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@your_image.jpg" \
  -F "app_id=1912088126456299522" \
  -F "version_id=1912088126460493825" \
  -F "cnet_form_id=17447123252810005" \
  -F "generate_num=1"
```

**å›æ‡‰ç¯„ä¾‹**:

```json
{
  "status": "success",
  "task_id": "task_12345678",
  "upload_result": {
    "imageUrl": "https://a1.art/path/to/uploaded/image.jpg",
    "path": "/uploads/image.jpg"
  },
  "local_path": "input/20231125_142530.jpg"
}
```

### 2. ä½¿ç”¨æ¨¡æ¿å‰µå»ºåœ–ç‰‡ç”Ÿæˆä»»å‹™ (æ¨è–¦)

**ç«¯é»**: `POST /generate`

**åƒæ•¸**:
- `file`: ä¸Šå‚³çš„åœ–ç‰‡æª”æ¡ˆ (å¿…éœ€)
- `template_id`: æ¨¡æ¿ ID (é è¨­: 0)

**è«‹æ±‚ç¯„ä¾‹**:

```bash
curl -X POST "http://localhost:1989/generate" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@your_image.jpg" \
  -F "template_id=0"
```

**å›æ‡‰ç¯„ä¾‹**:

```json
{
  "status": "success",
  "task_id": "task_12345678",
  "template_id": 0,
  "template_name": "æ¸¬è©¦æ¨¡æ¿-JOJO",
  "upload_result": {
    "imageUrl": "https://a1.art/path/to/uploaded/image.jpg",
    "path": "/uploads/image.jpg"
  },
  "local_path": "input/20231125_142530.jpg"
}
```

**èªªæ˜**:
- ä½¿ç”¨æ¨¡æ¿ ID è‡ªå‹•æŸ¥æ‰¾å°æ‡‰çš„ `app_id`ã€`version_id`ã€`cnet_form_id`
- æ›´ç°¡å–®ã€æ›´ä¸å®¹æ˜“å‡ºéŒ¯
- `generate_num` å›ºå®šç‚º 1

### 3. æŸ¥è©¢æ‰€æœ‰å¯ç”¨æ¨¡æ¿

**ç«¯é»**: `GET /templates`

**è«‹æ±‚ç¯„ä¾‹**:

```bash
curl "http://localhost:1989/templates"
```

**å›æ‡‰ç¯„ä¾‹**:

```json
{
  "status": "success",
  "count": 4,
  "templates": [
    {
      "template_id": 0,
      "name": "æ¸¬è©¦æ¨¡æ¿-JOJO",
      "app_id": "1940002918948761602",
      "version_id": "1940002918952955905",
      "cnet_form_id": "17361503364050001"
    }
  ]
}
```

### 4. æŸ¥è©¢ä»»å‹™ç‹€æ…‹

**ç«¯é»**: `GET /status/{task_id}`

**è«‹æ±‚ç¯„ä¾‹**:

```bash
curl "http://localhost:1989/status/task_12345678"
```

**å›æ‡‰ç¯„ä¾‹** (è™•ç†ä¸­):

```json
{
  "status": "success",
  "id": "task_12345678",
  "state_text": "PROCESSING",
  "state": 30,
  "startDate": "2023-11-25T14:25:30Z",
  "finishDate": null,
  "createDate": "2023-11-25T14:25:25Z",
  "images": []
}
```

**å›æ‡‰ç¯„ä¾‹** (å®Œæˆ):

```json
{
  "status": "success",
  "id": "task_12345678",
  "state_text": "COMPLETED",
  "state": 10,
  "startDate": "2023-11-25T14:25:30Z",
  "finishDate": "2023-11-25T14:27:45Z",
  "createDate": "2023-11-25T14:25:25Z",
  "images": [
    {
      "url": "https://a1.art/generated/image1.jpg",
      "thumbnail": "https://a1.art/generated/image1_thumb.jpg"
    }
  ]
}
```

### ä»»å‹™ç‹€æ…‹èªªæ˜

| ç‹€æ…‹ç¢¼ | ç‹€æ…‹åç¨± | èªªæ˜ |
|-------|---------|------|
| 10 | COMPLETED | ä»»å‹™å®Œæˆ |
| 20 | FAILED | ä»»å‹™å¤±æ•— |
| 30 | PROCESSING | è™•ç†ä¸­ |

## ç›®éŒ„çµæ§‹

```
â”œâ”€â”€ app.py                      # ä¸»æ‡‰ç”¨ç¨‹å¼
â”œâ”€â”€ requirements.txt            # Python ä¾è³´åŒ…
â”œâ”€â”€ .env                        # ç’°å¢ƒè®Šæ•¸é…ç½®
â”œâ”€â”€ templates.json              # æ¨¡æ¿é…ç½®æª”æ¡ˆï¼ˆä¸ä¸Šå‚³åˆ° Gitï¼‰
â”œâ”€â”€ templates_sample.json       # æ¨¡æ¿é…ç½®ç¯„ä¾‹æª”æ¡ˆ
â”œâ”€â”€ docker-compose.yaml         # Docker é…ç½®
â”œâ”€â”€ Dockerfile                  # Docker æ˜ åƒé…ç½®
â”œâ”€â”€ input/                      # ä¸Šå‚³æª”æ¡ˆå­˜æ”¾ç›®éŒ„
â”‚   â””â”€â”€ .gitkeep                # ç¢ºä¿ç›®éŒ„è¢« git è¿½è¹¤
â”œâ”€â”€ logs/                       # æ—¥èªŒæª”æ¡ˆç›®éŒ„
â”‚   â””â”€â”€ .gitkeep                # ç¢ºä¿ç›®éŒ„è¢« git è¿½è¹¤
â”œâ”€â”€ static/                     # éœæ…‹æª”æ¡ˆç›®éŒ„
â”‚   â”œâ”€â”€ index.html              # å‰ç«¯é é¢
â”‚   â””â”€â”€ template_images/        # æ¨¡æ¿é è¦½åœ–ç‰‡ç›®éŒ„ï¼ˆåœ–ç‰‡ä¸ä¸Šå‚³åˆ° Gitï¼‰
â”‚       â””â”€â”€ .gitkeep            # ç¢ºä¿ç›®éŒ„è¢« git è¿½è¹¤
â””â”€â”€ README.md                   # å°ˆæ¡ˆèªªæ˜æ–‡æª”
```

## Docker éƒ¨ç½²

### ä½¿ç”¨ Docker Compose

```bash
# å•Ÿå‹•æœå‹™
docker-compose up -d

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f

# åœæ­¢æœå‹™
docker-compose down
```

### ç’°å¢ƒè®Šæ•¸

åœ¨ä½¿ç”¨ Docker éƒ¨ç½²æ™‚ï¼Œè«‹ç¢ºä¿åœ¨ `.env` æª”æ¡ˆä¸­è¨­ç½®äº†æ­£ç¢ºçš„ `API_KEY`ï¼š

```env
API_KEY=your_a1_art_api_key_here
```

## æ—¥èªŒç³»çµ±

æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨ RotatingFileHandler é€²è¡Œæ—¥èªŒç®¡ç†ï¼š

- **æ—¥èªŒæª”æ¡ˆ**: `logs/app.log`
- **æª”æ¡ˆå¤§å°é™åˆ¶**: 10MB
- **å‚™ä»½æ•¸é‡**: 5 å€‹
- **æ—¥èªŒæ ¼å¼**: `æ™‚é–“ - åŸ·è¡Œç·’åç¨± - æ—¥èªŒç­‰ç´š - è¨Šæ¯å…§å®¹`

æ—¥èªŒæœƒåŒæ™‚è¼¸å‡ºåˆ°æ§åˆ¶å°å’Œæª”æ¡ˆï¼Œæ–¹ä¾¿é–‹ç™¼å’Œç”Ÿç”¢ç’°å¢ƒçš„ç›£æ§ã€‚

## é–‹ç™¼èªªæ˜

### æœ¬åœ°é–‹ç™¼

```bash
# å®‰è£é–‹ç™¼ä¾è³´
pip install -r requirements.txt

# å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
python app.py
```

### API æ–‡æª”èˆ‡æ¸¬è©¦

æœ¬æœå‹™æä¾›å®Œæ•´çš„ API äº’å‹•å¼æ–‡æª”ï¼Œæ–¹ä¾¿é–‹ç™¼å’Œæ¸¬è©¦ï¼š

#### Swagger UIï¼ˆæ¨è–¦ï¼‰
- **ç¶²å€**: `http://localhost:1989/docs`
- **åŠŸèƒ½**:
  - ğŸ“– æŸ¥çœ‹æ‰€æœ‰ API ç«¯é»è©³ç´°èªªæ˜
  - ğŸ§ª ç›´æ¥åœ¨ç€è¦½å™¨ä¸­æ¸¬è©¦ API
  - ğŸ“ æŸ¥çœ‹è«‹æ±‚/å›æ‡‰ç¯„ä¾‹
  - ğŸ”§ æ¸¬è©¦æª”æ¡ˆä¸Šå‚³åŠŸèƒ½
  - ğŸ“Š æŸ¥çœ‹è³‡æ–™æ¨¡å‹çµæ§‹

#### ReDoc
- **ç¶²å€**: `http://localhost:1989/redoc`
- **åŠŸèƒ½**:
  - ğŸ“š ç¾è§€çš„ API æ–‡æª”é–±è®€ä»‹é¢
  - ğŸ” æœå°‹åŠŸèƒ½
  - ğŸ“‹ æ›´é©åˆæ–‡æª”é–±è®€

#### API ç«¯é»åˆ†é¡
- **åœ–ç‰‡ç”Ÿæˆ**: `/create`ã€`/generate`
- **ä»»å‹™ç®¡ç†**: `/status/{task_id}`
- **æ¨¡æ¿ç®¡ç†**: `/templates`
- **ç¶²é ä»‹é¢**: `/`ï¼ˆå‰ç«¯é é¢ï¼‰

## éŒ¯èª¤è™•ç†

æœå‹™åŒ…å«å®Œæ•´çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼š

- **400 Bad Request**: åƒæ•¸éŒ¯èª¤æˆ– A1.art API è«‹æ±‚å¤±æ•—
- **500 Internal Server Error**: æœå‹™å…§éƒ¨éŒ¯èª¤
- **è©³ç´°éŒ¯èª¤è¨Šæ¯**: æ‰€æœ‰éŒ¯èª¤éƒ½æœƒè¨˜éŒ„åœ¨æ—¥èªŒä¸­ä¸¦è¿”å›çµ¦å®¢æˆ¶ç«¯

## æ³¨æ„äº‹é …

1. **API Key**: è«‹ç¢ºä¿è¨­ç½®æ­£ç¢ºçš„ A1.art API Key
2. **æª”æ¡ˆå¤§å°**: æ³¨æ„ä¸Šå‚³æª”æ¡ˆçš„å¤§å°é™åˆ¶
3. **ä»»å‹™è¶…æ™‚**: åœ–ç‰‡ç”Ÿæˆå¯èƒ½éœ€è¦ä¸€äº›æ™‚é–“ï¼Œè«‹è€å¿ƒç­‰å¾…
4. **æ—¥èªŒç›£æ§**: å®šæœŸæª¢æŸ¥æ—¥èªŒæª”æ¡ˆä»¥ç›£æ§æœå‹™é‹è¡Œç‹€æ…‹

## æˆæ¬Š

æ­¤å°ˆæ¡ˆåƒ…ä¾›å­¸ç¿’å’Œé–‹ç™¼ä½¿ç”¨ã€‚è«‹éµå¾ª A1.art çš„æœå‹™æ¢æ¬¾å’Œä½¿ç”¨é™åˆ¶ã€‚
